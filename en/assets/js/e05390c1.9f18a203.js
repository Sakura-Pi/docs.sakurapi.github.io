"use strict";(self.webpackChunkdocs_sakurapi_org=self.webpackChunkdocs_sakurapi_org||[]).push([[699],{4161:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"article/sakurapi-rk3308b/playground/ws2812-leds","title":"\u70b9\u4eae\u677f\u8f7d WS2812 LED","description":"\u672c\u6587\u8bb2\u8ff0\u4e86\u5982\u4f55\u4f7f\u7528 spidev \u6216\u6211\u4eec\u7684\u5185\u6838\u9a71\u52a8\u70b9\u4eae\u677f\u8f7d WS2812 LED","source":"@site/docs/article/sakurapi-rk3308b/playground/ws2812-leds.md","sourceDirName":"article/sakurapi-rk3308b/playground","slug":"/article/sakurapi-rk3308b/playground/ws2812-leds","permalink":"/en/article/sakurapi-rk3308b/playground/ws2812-leds","draft":false,"unlisted":false,"editUrl":"https://github.com/Sakura-Pi/docs.sakurapi.org/docs/article/sakurapi-rk3308b/playground/ws2812-leds.md","tags":[],"version":"current","frontMatter":{"id":"ws2812-leds","title":"\u70b9\u4eae\u677f\u8f7d WS2812 LED"},"sidebar":"docs","previous":{"title":"\u8fde\u63a5 RGB \u663e\u793a\u5c4f","permalink":"/en/article/sakurapi-rk3308b/playground/rgb-display"}}');var i=n(4848),r=n(8453);const d={id:"ws2812-leds",title:"\u70b9\u4eae\u677f\u8f7d WS2812 LED"},l=void 0,o={},a=[{value:"\u5f15\u8a00",id:"\u5f15\u8a00",level:2},{value:"\u672f\u8bed\u5f15\u7528\u8868",id:"\u672f\u8bed\u5f15\u7528\u8868",level:3},{value:"\u6458\u8981",id:"\u6458\u8981",level:3},{value:"WS2812 \u901a\u8baf\u534f\u8bae",id:"ws2812-\u901a\u8baf\u534f\u8bae",level:2},{value:"\u4e13\u6709\u5185\u6838\u9a71\u52a8",id:"\u4e13\u6709\u5185\u6838\u9a71\u52a8",level:2},{value:"\u914d\u7f6e dtbo",id:"\u914d\u7f6e-dtbo",level:3},{value:"\u7f16\u8bd1\u5185\u6838\u9a71\u52a8",id:"\u7f16\u8bd1\u5185\u6838\u9a71\u52a8",level:3},{value:"\u547d\u4ee4\u884c\u6d4b\u8bd5",id:"\u547d\u4ee4\u884c\u6d4b\u8bd5",level:3},{value:"\u4f7f\u7528 spidev \u9a71\u52a8",id:"\u4f7f\u7528-spidev-\u9a71\u52a8",level:2}];function c(t){const e={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...t.components},{Details:s}=e;return s||function(t,e){throw new Error("Expected "+(e?"component":"object")+" `"+t+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.admonition,{title:"\u96be\u5ea6\u7b49\u7ea7 \u2605\u2605\u2605\u2606\u2606",type:"info"}),"\n",(0,i.jsx)(e.admonition,{title:"\u7ae0\u8282\u63d0\u793a",type:"tip",children:(0,i.jsx)(e.p,{children:"\u672c\u6587\u8bb2\u8ff0\u4e86\u5982\u4f55\u4f7f\u7528 spidev \u6216\u6211\u4eec\u7684\u5185\u6838\u9a71\u52a8\u70b9\u4eae\u677f\u8f7d WS2812 LED"})}),"\n",(0,i.jsx)(e.h2,{id:"\u5f15\u8a00",children:"\u5f15\u8a00"}),"\n",(0,i.jsx)(e.h3,{id:"\u672f\u8bed\u5f15\u7528\u8868",children:"\u672f\u8bed\u5f15\u7528\u8868"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u672f\u8bed"}),(0,i.jsx)(e.th,{children:"\u5bf9\u5e94\u89e3\u91ca"})]})}),(0,i.jsx)(e.tbody,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spidev"}),(0,i.jsx)(e.td,{children:"SPI device"})]})})]}),"\n",(0,i.jsx)(e.h3,{id:"\u6458\u8981",children:"\u6458\u8981"}),"\n",(0,i.jsx)(e.p,{children:"Sakura Pi RK3308B \u677f\u8f7d\u4e86 4 \u679a\u7cbe\u81f4\u5c0f\u5de7\u7684 WS2812 LED\u3002\u5b83\u4eec\u53ef\u7528\u4e8e\u9519\u8bef\u8b66\u544a\u3001\u5fc3\u8df3\u3001HDD\u8bfb\u5199\u7b49\u7684\u6307\u793a\uff0c\u751a\u81f3\u663e\u793a\u7b80\u5355\u52a8\u753b\u3002\n\u4f46\u662f\u56e0\u4e3a WS2812 \u534f\u8bae\u7684\u7279\u6b8a\u6027\uff0c\u5230\u76ee\u524d\u4e3a\u6b62 Linux \u59cb\u7ec8\u6ca1\u6709 WS2812 \u7684\u5b98\u65b9\u5185\u6838\u9a71\u52a8\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u624b\u52a8\u6765\u6dfb\u52a0\u5bf9\u5b83\u4eec\u7684\u652f\u6301\u3002"}),"\n",(0,i.jsx)(e.admonition,{title:"\u534f\u8bae\u7279\u6b8a\u6027",type:"tip",children:(0,i.jsx)(e.p,{children:"\u7279\u6b8a\u6027\u662f\u6307\u76ee\u524d\u6ca1\u6709\u5e7f\u6cdb\u4f7f\u7528\u7684\u3001\u4e13\u95e8\u7528\u4e8e WS2812 \u7684\u786c\u4ef6\u6216\u7535\u8def\u7684 IP \u6838\u3002SPI \u7684 MOSI \u8bbe\u8ba1\u4e0a\u662f 'Master Out Slave In'\uff0c\n\u5b83\u53ea\u8981\u4f7f\u7528\u5408\u9002\u7684\u9891\u7387\u5c31\u53ef\u4ee5\u88ab\u6ee5\u7528\u6210\u53ef\u7f16\u7a0b\u7684\u6ce2\u5f62\u751f\u6210\u5668\uff0c\u4ece\u800c\u53ef\u4ee5\u7528\u505a\u5404\u79cd\u534f\u8bae\u7684\u9a71\u52a8\u65f6\u5e8f\u3002\u867d\u7136\u5b83\u4ece\u8bbe\u8ba1\u4e0a\u5e76\u4e0d\u662f\u7528\u4e8e WS2812 \u7684\u3002"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u5c06 WS2812 \u7684 DIN ",(0,i.jsx)(e.em,{children:"(Data In)"})," \u8fde\u63a5\u5230\u4e86 RK3308B \u7684 SPI MOSI \u63a5\u53e3\u4e0a\u3002\u6240\u4ee5\u60f3\u8981\u70b9\u4eae\u5b83\u4eec\u53ea\u9700\u8981\u7f16\u5199\u7b26\u5408\u89c4\u8303\u7684 SPI \u5185\u6838\u9a71\u52a8\uff0c\n\u6216\u8005\u5728\u7528\u6237\u7a7a\u95f4\u4e0b\u4f7f\u7528 Python \u5bf9 spidev \u8fdb\u884c\u8f93\u51fa\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528\u4f60\u559c\u6b22\u7684\u8bed\u8a00\u5bf9 spidev \u7f16\u7a0b\uff0c\u7136\u540e\u70b9\u4eae\u5b83\u4eec\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"ws2812-\u901a\u8baf\u534f\u8bae",children:"WS2812 \u901a\u8baf\u534f\u8bae"}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.mdxAdmonitionTitle,{children:["\u5982\u679c\u4f60\u53ea\u60f3\u7acb\u523b\u70b9\u4eae\u5b83\uff0c\u8bf7\u8f6c\u5230 ",(0,i.jsx)(e.a,{href:"#%E4%B8%93%E6%9C%89%E5%86%85%E6%A0%B8%E9%A9%B1%E5%8A%A8",children:"\u4e13\u6709\u5185\u6838\u9a71\u52a8"})," \u7ae0\u8282"]})}),"\n",(0,i.jsx)(e.p,{children:"WS2812 \u4f7f\u7528\u4e86\u4e00\u4e2a\u5341\u5206\u7b80\u6d01\u7684\u4e09\u8282\u62cd\u5236\u7684\u4e32\u884c\u901a\u8baf\u534f\u8bae\uff0c"}),"\n",(0,i.jsx)(e.admonition,{title:"TODO: \u8be6\u7ec6\u89e3\u91ca WS2812 \u7684\u534f\u8bae\u89c4\u8303",type:"info"}),"\n",(0,i.jsx)(e.h2,{id:"\u4e13\u6709\u5185\u6838\u9a71\u52a8",children:"\u4e13\u6709\u5185\u6838\u9a71\u52a8"}),"\n",(0,i.jsx)(e.admonition,{title:"GitHub \u4ed3\u5e93\u5730\u5740",type:"info",children:(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://github.com/Sakura-Pi/ws2812-vleds",children:"https://github.com/Sakura-Pi/ws2812-vleds"})})}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4eec\u4e3a\u6b64\u5199\u4e86\u4e00\u4e2a\u5185\u6838\u9a71\u52a8\u7528\u6765\u9002\u914d WS2812\u3002\u5b83\u4f7f\u7528\u8bbe\u5907\u6811\u53bb\u63cf\u8ff0\u989c\u8272\u3001\u4f4d\u7f6e\u3001\u529f\u80fd\u4ee5\u53ca\u7ed1\u5b9a\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5c06 WS2812 \u5f53\u4f5c\u666e\u901a LED \u4e00\u6837\u4f7f\u7528\uff0c\u5177\u6709\u7b80\u5355\u7075\u6d3b\u7684\u7279\u6027\u3002\n\u5b83\u4e0d\u4ec5\u53ef\u4ee5\u9a71\u52a8\u677f\u8f7d\u7684 WS2812\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u9a71\u52a8 WS2812 \u706f\u5e26\u6216\u77e9\u9635\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u9a71\u52a8\u5e76\u4e0d\u9002\u5408\u7528\u6765\u628a WS2812 \u4f5c\u4e3a\u5c4f\u5e55\u3002"}),"\n",(0,i.jsx)(e.admonition,{type:"warning",children:(0,i.jsx)(e.p,{children:"\u8fd9\u4e2a\u9a71\u52a8\u76ee\u524d\u5b9e\u73b0\u76ee\u524d\u8fd8\u4e0d\u5b8c\u6574\uff0c\u90e8\u5206\u7279\u6027\u8fd8\u5904\u4e8e\u5f00\u53d1\u9636\u6bb5\uff0c\u8bf7\u5c0f\u5fc3\u4f7f\u7528\u3002"})}),"\n",(0,i.jsx)(e.h3,{id:"\u914d\u7f6e-dtbo",children:"\u914d\u7f6e dtbo"}),"\n",(0,i.jsxs)(e.p,{children:["\u8be5 dtso \u4f4d\u4e8e Armbian \u7684\u4e3b\u7ebf\u4ed3\u5e93\u5185\uff0c\u9ed8\u8ba4\u4f1a\u968f\u7740\u53d1\u884c\u7248\u81ea\u52a8\u7f16\u8bd1\u6210 dtbo \u5e76\u653e\u5230 ",(0,i.jsx)(e.code,{children:"/boot/dtb/rockchip/overlay"})," \u76ee\u5f55\u4e0b\u3002",(0,i.jsxs)(e.strong,{children:["\u5982\u679c\u4f60\u60f3\u76f4\u63a5\u4f7f\u7528\u5b83\uff0c\u8bf7\u5728 ",(0,i.jsx)(e.code,{children:"/boot/armbianEnv.txt"}),"\n\u7684 overlays \u884c\u52a0\u5165 sakurapi-rk3308b-ws2812 \u5373\u53ef (\u5982\u679c\u6ca1\u6709\u8fd9\u884c\u5c31\u6dfb\u52a0)"]}),"\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Snipaste_2025-05-14_21-11-28.jpg",src:n(6401).A+"",width:"1068",height:"340"})}),"\n",(0,i.jsxs)(e.p,{children:["\u91cd\u542f\uff0c\u5e76\u68c0\u67e5 u-boot \u7684\u8f93\u51fa\n",(0,i.jsx)(e.img,{alt:"Snipaste_2025-05-14_21-55-28.jpg",src:n(7841).A+"",width:"1360",height:"740"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u4f60\u9700\u8981\u81ea\u8ba2 dtso\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6211\u4eec\u8fd9\u4e2a\u5f00\u53d1\u677f\u9700\u8981\u5199\u6210\u4e0b\u9762\u8fd9\u6837\u3002\u6216\u8005\u53c2\u9605:",(0,i.jsx)(e.br,{}),"\n",(0,i.jsx)(e.a,{href:"https://github.com/Sakura-Pi/build/blob/main/patch/kernel/archive/rockchip64-6.14/overlay/rockchip-sakurapi-rk3308b-ws2812.dtso",children:"https://github.com/Sakura-Pi/build/blob/main/patch/kernel/archive/rockchip64-6.14/overlay/rockchip-sakurapi-rk3308b-ws2812.dtso"})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"rockchip-sakurapi-rk3308b-ws2812.dtso"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-dts",children:'/ {\n\tfragment@0 {\n\t\ttarget = <&spi1>;\n\t\t__overlay__ {\n\n\t\t\tstatus = "okay";\n\n\t\t\tws2812@0 {\n\t\t\t\tcompatible = "ws2812-vleds";\n\t\t\t\treg = <0>;\n\n\t\t\t\t// spi \u65f6\u949f\u901f\u5ea6\n\t\t\t\tspi-max-frequency = <6750000>;\n\n\t\t\t\tleds {\n\n\t\t\t\t\t// \u7528\u6237\u5b9a\u4e49\n\t\t\t\t\tws_led3: vled3 {\n\t\t\t\t\t\tlabel = "ws-led3";\n\t\t\t\t\t\tdefault-state = "off";\n\t\t\t\t\t\tcolor-value = "#69b3f2";\n\t\t\t\t\t};\n\n\t\t\t\t\t// \u7528\u6237\u5b9a\u4e49\n\t\t\t\t\tws_led2: vled2 {\n\t\t\t\t\t\tlabel = "ws-led2";\n\t\t\t\t\t\tdefault-state = "off";\n\t\t\t\t\t\tcolor-value = "#9376c8";\n\t\t\t\t\t};\n\n\t\t\t\t\t// \u7528\u6237\u5b9a\u4e49\n\t\t\t\t\tws_led1: vled1 {\n\t\t\t\t\t\tlabel = "ws-led1";\n\t\t\t\t\t\tdefault-state = "off";\n\t\t\t\t\t\tcolor-value = "#b66bc3";\n\t\t\t\t\t};\n\n\t\t\t\t\t// \u7528\u6237\u5b9a\u4e49 \u9ed8\u8ba4\u529f\u80fd mmc1 \u8bfb\u5199\u72b6\u6001\n\t\t\t\t\t// mmc1(emmc) r/w state\n\t\t\t\t\tws_led0: vled0 {\n\t\t\t\t\t\tlabel = "ws-led0";\n\t\t\t\t\t\tdefault-state = "on";\n\t\t\t\t\t\tlinux,default-trigger = "mmc1";\n\t\t\t\t\t\tcolor-value = "#eb698f";\n\t\t\t\t\t};\n\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n};\n\n'})})]}),"\n",(0,i.jsx)(e.h3,{id:"\u7f16\u8bd1\u5185\u6838\u9a71\u52a8",children:"\u7f16\u8bd1\u5185\u6838\u9a71\u52a8"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528\u547d\u4ee4\u514b\u9686\u6574\u4e2a git \u4ed3\u5e93"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"git clone https://github.com/Sakura-Pi/ws2812-vleds --depth 1\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u8fdb\u5165 ws2812-vleds \u76ee\u5f55\uff0cmake \u7f16\u8bd1\u5e76 insmod \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u5c31\u80fd\u770b\u5230\u6211\u4eec\u7684 WS2812 \u865a\u62df LED \u8bbe\u5907\u4e86\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"$ make\nmake -C /lib/modules/6.12.23-current-rockchip64/build M=/root/ws2812-vleds modules\nmake[1]: Entering directory '/usr/src/linux-headers-6.12.23-current-rockchip64'\n  CC [M]  /root/ws2812-vleds/src/main.o\nIn file included from /root/ws2812-vleds/src/main.c:12:\n  LD [M]  /root/ws2812-vleds/ws2812-vleds.o\n  MODPOST /root/ws2812-vleds/Module.symvers\n  CC [M]  /root/ws2812-vleds/ws2812-vleds.mod.o\n  CC [M]  /root/ws2812-vleds/.module-common.o\n  LD [M]  /root/ws2812-vleds/ws2812-vleds.ko\nmake[1]: Leaving directory '/usr/src/linux-headers-6.12.23-current-rockchip64'\n\n\u5b89\u88c5\u5185\u6838\u6a21\u5757\n$ sudo insmod ws2812-vleds.ko\n\n# \u67e5\u770b\u8bbe\u5907\n$ ls /sys/class/led/\n"})}),"\n",(0,i.jsxs)(e.admonition,{title:"\u6ce8\u610f\u4e8b\u9879",type:"warning",children:[(0,i.jsxs)(e.p,{children:["\u5982\u679c make \u51fa\u73b0\u4ee5\u4e0b\u62a5\u9519\uff0c\u8bf4\u660e\u4f60\u7f3a\u5c11 linux-headers \u5305\u3002",(0,i.jsx)(e.br,{}),"\n","\u56e0\u4e3a\u7f3a\u5c11\u4e86\u5185\u6838\u5934\u6587\u4ef6\uff0c\u65e0\u6cd5\u7f16\u8bd1\u5185\u6838\u6a21\u5757\u3002"]}),(0,i.jsxs)(e.p,{children:["make -C /lib/modules/6.12.20-current-rockchip64/build M=/root/ws2812-vleds modules",(0,i.jsx)(e.br,{}),"\n","make[1]: *** /lib/modules/6.12.20-current-rockchip64/build: No such file or directory.  Stop.",(0,i.jsx)(e.br,{}),"\n","make: *** [Makefile:8: all] Error 2"]})]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u4e00\u5207\u6b63\u5e38\uff0c\u5982\u56fe\u6240\u793a\n",(0,i.jsx)(e.img,{alt:"Snipaste_2025-05-14_21-59-17.jpg",src:n(8743).A+"",width:"1103",height:"500"})]}),"\n",(0,i.jsx)(e.h3,{id:"\u547d\u4ee4\u884c\u6d4b\u8bd5",children:"\u547d\u4ee4\u884c\u6d4b\u8bd5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"echo 255 > /sys/class/leds/<\u4f60\u7684 LED \u8bbe\u5907\u540d>/brightness\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4f7f\u7528-spidev-\u9a71\u52a8",children:"\u4f7f\u7528 spidev \u9a71\u52a8"}),"\n",(0,i.jsx)(e.admonition,{title:"TODO",type:"info",children:(0,i.jsx)(e.p,{children:"\u5f85\u5b8c\u6210 python \u793a\u4f8b"})})]})}function h(t={}){const{wrapper:e}={...(0,r.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(c,{...t})}):c(t)}},6401:(t,e,n)=>{n.d(e,{A:()=>s});const s=n.p+"assets/images/Snipaste_2025-05-14_21-11-28-0861c64d75215baccd442b2793c1ea47.jpg"},7841:(t,e,n)=>{n.d(e,{A:()=>s});const s=n.p+"assets/images/Snipaste_2025-05-14_21-55-28-7a6144555e086bc4ee286b5a7834908b.jpg"},8453:(t,e,n)=>{n.d(e,{R:()=>d,x:()=>l});var s=n(6540);const i={},r=s.createContext(i);function d(t){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function l(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:d(t.components),s.createElement(r.Provider,{value:e},t.children)}},8743:(t,e,n)=>{n.d(e,{A:()=>s});const s=n.p+"assets/images/Snipaste_2025-05-14_21-59-17-554a8a03be4bd5dc605bc315c93b81e2.jpg"}}]);